worker_processes 2;
error_log /var/log/nginx-error.log info;
events {
	worker_connections 2048;
}
http {
	log_format compression "$remote_addr - $remote_user [$time_local] " '"$request" $status $bytes_sent ' '"$http_referer" "$http_user_agent" "$gzip_ratio"';
	access_log /spool/logs/nginx-access.log compression buffer=32k;
	upstream backend {
		zone http_backend 64k;
		server backend1.example.com weight=5;
		server backend2.example.com;
	}
	proxy_cache_path /data/nginx/cache_backend keys_zone=cache_backend:10m;
	server {
		server_name backend.example.com;
		ssl_certificate /etc/ssl/cert.pem;
		location / {
			proxy_pass http://backend;
			proxy_cache cache_backend;
			health_check;
		}
		status_zone server_backend;
	}
	keyval_zone zone=one:32k state=one.keyval;
	keyval $arg_text $text zone=one;
	server {
		listen 127.0.0.1:49151;
		location /newapi {
			api write=on;
			allow 127.0.0.1;
			deny all;
		}
	}
}
stream {
	upstream backend {
		zone stream_backend 64k;
		server backend1.example.com:12345 weight=5;
		server backend2.example.com:12345;
	}
	server {
		listen 127.0.0.1:12345;
		proxy_pass backend;
		status_zone server_backend;
		health_check;
	}
}